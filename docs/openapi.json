{
  "openapi": "3.0.0",
  "info": {
    "title": "Cementerio API",
    "version": "1.0.0",
    "description": "API del Sistema de Gestión de Nichos del Cementerio No. 2"
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Local"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "description": "",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/nichos": {
      "get": {
        "tags": [
          "Nichos"
        ],
        "summary": "Listar nichos",
        "description": "Permite filtrar por manzana, estado y search",
        "parameters": [
          {
            "name": "manzana",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "estado",
            "in": "query",
            "enum": [
              "Disponible",
              "Reservado",
              "Ocupado"
            ],
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "post": {
        "tags": [
          "Nichos"
        ],
        "summary": "Crear nicho",
        "description": "",
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateNicho"
              }
            }
          }
        }
      }
    },
    "/api/nichos/{id}": {
      "get": {
        "tags": [
          "Nichos"
        ],
        "summary": "Obtener nicho por ID",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "put": {
        "tags": [
          "Nichos"
        ],
        "summary": "Actualizar nicho por ID",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateNicho"
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Nichos"
        ],
        "summary": "Eliminar nicho por ID",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "204": {
            "description": "No Content"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/nichos/por-numero": {
      "get": {
        "tags": [
          "Nichos"
        ],
        "summary": "Buscar nicho por número + manzana (id o nombre)",
        "description": "",
        "parameters": [
          {
            "name": "numero",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "manzana_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "manzana",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/nichos/{id}/estado": {
      "patch": {
        "tags": [
          "Nichos"
        ],
        "summary": "Cambiar estado de un nicho",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Nicho actualizado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Nicho"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Nicho"
                }
              }
            }
          },
          "400": {
            "description": "Validación",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "No encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "nuevo_estado"
                ],
                "properties": {
                  "nuevo_estado": {
                    "type": "string",
                    "enum": [
                      "Disponible",
                      "Reservado",
                      "Ocupado",
                      "Mantenimiento",
                      "Bloqueado"
                    ],
                    "example": "Reservado"
                  },
                  "motivo": {
                    "type": "string",
                    "example": "Reserva por solicitud #456"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/nichos/{id}/historial": {
      "get": {
        "tags": [
          "Nichos"
        ],
        "summary": "Historial de cambios de estado de un nicho",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Historial",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "example": "array"
                    },
                    "items": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string",
                          "example": "object"
                        },
                        "properties": {
                          "type": "object",
                          "properties": {
                            "fecha": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                }
                              }
                            },
                            "de": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                }
                              }
                            },
                            "a": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                }
                              }
                            },
                            "motivo": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                },
                                "nullable": {
                                  "type": "boolean",
                                  "example": true
                                }
                              }
                            },
                            "usuario_id": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "integer"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "xml": {
                    "name": "main"
                  }
                }
              },
              "application/xml": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "example": "array"
                    },
                    "items": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string",
                          "example": "object"
                        },
                        "properties": {
                          "type": "object",
                          "properties": {
                            "fecha": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                }
                              }
                            },
                            "de": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                }
                              }
                            },
                            "a": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                }
                              }
                            },
                            "motivo": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "string"
                                },
                                "nullable": {
                                  "type": "boolean",
                                  "example": true
                                }
                              }
                            },
                            "usuario_id": {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "example": "integer"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "xml": {
                    "name": "main"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not Found"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/manzanas": {
      "get": {
        "tags": [
          "Manzanas"
        ],
        "summary": "Listar manzanas",
        "description": "Permite filtrar por nombre (query param search)",
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "post": {
        "tags": [
          "Manzanas"
        ],
        "summary": "Crear manzana",
        "description": "",
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "nombre"
                ],
                "properties": {
                  "nombre": {
                    "type": "string",
                    "example": "A"
                  }
                }
              },
              "example": {
                "nombre": "C"
              }
            }
          }
        }
      }
    },
    "/api/manzanas/{id}": {
      "get": {
        "tags": [
          "Manzanas"
        ],
        "summary": "Obtener manzana por ID",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "put": {
        "tags": [
          "Manzanas"
        ],
        "summary": "Actualizar manzana",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nombre": {
                    "type": "string",
                    "example": "B"
                  }
                }
              },
              "example": {
                "nombre": "B"
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manzanas"
        ],
        "summary": "Eliminar manzana",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "204": {
            "description": "No Content"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/propietarios": {
      "get": {
        "tags": [
          "Propietarios"
        ],
        "summary": "Listar propietarios",
        "description": "Filtra por nombre/apellido/DPI con ?search=",
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "post": {
        "tags": [
          "Propietarios"
        ],
        "summary": "Crear propietario",
        "description": "",
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "nombres",
                  "apellidos",
                  "dpi"
                ],
                "properties": {
                  "nombres": {
                    "type": "string",
                    "example": "María José"
                  },
                  "apellidos": {
                    "type": "string",
                    "example": "López Pérez"
                  },
                  "dpi": {
                    "type": "string",
                    "example": "1234567890101"
                  },
                  "telefono": {
                    "type": "string",
                    "example": "5555-1234"
                  }
                }
              },
              "example": {
                "nombres": "María",
                "apellidos": "López",
                "dpi": "1234567890101",
                "telefono": "55551234"
              }
            }
          }
        }
      }
    },
    "/api/propietarios/{id}": {
      "get": {
        "tags": [
          "Propietarios"
        ],
        "summary": "Obtener propietario por ID",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "put": {
        "tags": [
          "Propietarios"
        ],
        "summary": "Actualizar propietario",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nombres": {
                    "type": "string",
                    "example": "María José"
                  },
                  "apellidos": {
                    "type": "string",
                    "example": "López Pérez"
                  },
                  "dpi": {
                    "type": "string",
                    "example": "1234567890101"
                  },
                  "telefono": {
                    "type": "string",
                    "example": "5555-1234"
                  }
                }
              },
              "example": {
                "telefono": "55551234"
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Propietarios"
        ],
        "summary": "Eliminar propietario",
        "description": "",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "minimum": 1
          }
        ],
        "responses": {
          "204": {
            "description": "No Content"
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/catalogs/manzanas": {
      "get": {
        "tags": [
          "Catálogos"
        ],
        "summary": "Lista de manzanas (catálogo)",
        "description": "Filtra por ?search= y ?includeInactive=[true|false]. Solo manzanas activas por defecto.",
        "parameters": [
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "includeInactive",
            "in": "query",
            "default": false,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/CatalogManzana"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "post": {
        "tags": [
          "Catálogos"
        ],
        "summary": "Crear/editar/activar/desactivar manzana",
        "description": "",
        "responses": {
          "201": {
            "description": "Creado / Actualizado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CatalogManzana"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflicto (duplicado o no se puede desactivar por uso)"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpsertManzana"
              },
              "examples": {
                "crear": {
                  "value": {
                    "nombre": "C"
                  }
                },
                "renombrar": {
                  "value": {
                    "id": 3,
                    "nombre": "B"
                  }
                },
                "desactivar": {
                  "value": {
                    "id": 3,
                    "activo": false
                  }
                },
                "activar": {
                  "value": {
                    "id": 3,
                    "activo": true
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/catalogs/tarifas": {
      "get": {
        "tags": [
          "Catálogos"
        ],
        "summary": "Tarifas vigentes/históricas",
        "description": "Consulta por fecha ?on=YYYY-MM-DD (default: hoy). Filtros: concepto, alcance, tipo_nicho_id, manzana_id, sector_id. ?includeHistory=true devuelve todo.",
        "parameters": [
          {
            "name": "on",
            "in": "query",
            "example": "2025-09-08",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "includeHistory",
            "in": "query",
            "default": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "concepto",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "alcance",
            "in": "query",
            "enum": [
              "GLOBAL",
              "POR_TIPO",
              "POR_ZONA"
            ],
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "tipo_nicho_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "manzana_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "sector_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Tarifa"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      },
      "post": {
        "tags": [
          "Catálogos"
        ],
        "summary": "Nueva vigencia de tarifa (sin solapes)",
        "description": "Crea una tarifa válida desde una fecha; valida que no haya solape con otra tarifa del mismo concepto/alcance/dimensiones.",
        "responses": {
          "201": {
            "description": "Creado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Tarifa"
                }
              }
            }
          },
          "409": {
            "description": "Conflicto: solapa con una tarifa vigente en ese alcance/fecha"
          },
          "422": {
            "description": "Parámetros inválidos para el alcance"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateTarifa"
              },
              "example": {
                "concepto": "ARRIENDO_7AÑOS",
                "alcance": "GLOBAL",
                "monto": 700,
                "moneda": "GTQ",
                "vigencia_desde": "2025-01-01"
              }
            }
          }
        }
      }
    },
    "/api/catalogs/estados-nicho": {
      "get": {
        "tags": [
          "Catálogos"
        ],
        "summary": "Estados permitidos de Nicho",
        "description": "",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": [
                      "Disponible",
                      "Reservado",
                      "Ocupado",
                      "Mantenimiento",
                      "Bloqueado"
                    ]
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Login",
        "description": "Autentica por correo + password. Devuelve access_token JWT y refresh_token rotativo.",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Credenciales inválidas o usuario inactivo"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "example": {
                "correo": "admin@demo.com",
                "password": "Secreta123"
              }
            }
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Refresh token",
        "description": "Intercambia el refresh_token por un nuevo par (access y refresh). Rotación segura.",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefreshResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Refresh inválido/expirado/revocado"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefreshRequest"
              },
              "example": {
                "refresh_token": "<token>"
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Logout",
        "description": "Revoca un refresh_token (o todos del usuario si envías Authorization: Bearer + { allDevices:true }).",
        "responses": {
          "204": {
            "description": "Sin contenido"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "No autorizado"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LogoutRequest"
              },
              "examples": {
                "soloEste": {
                  "value": {
                    "refresh_token": "<token>"
                  }
                },
                "todosMisDispositivos": {
                  "value": {
                    "allDevices": true
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "Perfil del usuario autenticado",
        "description": "",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MeUser"
                }
              }
            }
          },
          "401": {
            "description": "Token inválido/ausente"
          },
          "500": {
            "description": "Internal Server Error"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Nicho": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 1
                  }
                }
              },
              "numero": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 12
                  }
                }
              },
              "estado": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "Disponible",
                      "Reservado",
                      "Ocupado",
                      "Mantenimiento",
                      "Bloqueado"
                    ],
                    "items": {
                      "type": "string"
                    }
                  },
                  "example": {
                    "type": "string",
                    "example": "Disponible"
                  }
                }
              },
              "manzana_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 2
                  }
                }
              },
              "manzana": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "B"
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "Nicho"
        }
      },
      "CreateNicho": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "numero",
              "manzana_id"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "numero": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 10
                  }
                }
              },
              "estado": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "Disponible",
                      "Reservado",
                      "Ocupado",
                      "Mantenimiento",
                      "Bloqueado"
                    ],
                    "items": {
                      "type": "string"
                    }
                  },
                  "default": {
                    "type": "string",
                    "example": "Disponible"
                  }
                }
              },
              "manzana_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 1
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "CreateNicho"
        }
      },
      "UpdateNicho": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "numero": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 15
                  }
                }
              },
              "estado": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "Disponible",
                      "Reservado",
                      "Ocupado",
                      "Mantenimiento",
                      "Bloqueado"
                    ],
                    "items": {
                      "type": "string"
                    }
                  }
                }
              },
              "manzana_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 3
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "UpdateNicho"
        }
      },
      "CambioEstadoRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "nuevo_estado"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "nuevo_estado": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "Disponible",
                      "Reservado",
                      "Ocupado",
                      "Mantenimiento",
                      "Bloqueado"
                    ],
                    "items": {
                      "type": "string"
                    }
                  },
                  "example": {
                    "type": "string",
                    "example": "Reservado"
                  }
                }
              },
              "motivo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "Reserva por solicitud #456"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "CambioEstadoRequest"
        }
      },
      "HistorialEstadoItem": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "fecha": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "2025-09-10T16:32:11Z"
                  }
                }
              },
              "de": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "Disponible"
                  }
                }
              },
              "a": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "Reservado"
                  }
                }
              },
              "motivo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "Reserva por solicitud #456"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              },
              "usuario_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 7
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "HistorialEstadoItem"
        }
      },
      "LoginRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "correo",
              "password"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "correo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "admin@demo.com"
                  }
                }
              },
              "password": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "Secreta123"
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "LoginRequest"
        }
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "token_type": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "Bearer"
                  }
                }
              },
              "access_token": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "expires_in": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 900
                  }
                }
              },
              "refresh_token": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "user": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "object"
                  },
                  "properties": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "example": "integer"
                          },
                          "example": {
                            "type": "number",
                            "example": 1
                          }
                        }
                      },
                      "nombre_completo": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "example": "string"
                          },
                          "example": {
                            "type": "string",
                            "example": "Admin General"
                          }
                        }
                      },
                      "correo": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "example": "string"
                          },
                          "example": {
                            "type": "string",
                            "example": "admin@demo.com"
                          }
                        }
                      },
                      "rol_id": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "example": "integer"
                          },
                          "example": {
                            "type": "number",
                            "example": 1
                          }
                        }
                      },
                      "rol": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "example": "string"
                          },
                          "example": {
                            "type": "string",
                            "example": "Admin"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "LoginResponse"
        }
      },
      "RefreshRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "refresh_token"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "refresh_token": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "RefreshRequest"
        }
      },
      "RefreshResponse": {
        "xml": {
          "name": "RefreshResponse"
        },
        "$ref": "#/components/schemas/LoginResponse"
      },
      "LogoutRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "refresh_token": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "allDevices": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  },
                  "example": {
                    "type": "boolean",
                    "example": false
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "LogoutRequest"
        }
      },
      "MeUser": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "nombre_completo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "correo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "rol_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "rol": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              },
              "activo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "MeUser"
        }
      },
      "CatalogManzana": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 1
                  }
                }
              },
              "nombre": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "A"
                  }
                }
              },
              "activo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  },
                  "example": {
                    "type": "boolean",
                    "example": true
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "CatalogManzana"
        }
      },
      "UpsertManzana": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 3
                  }
                }
              },
              "nombre": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "C"
                  }
                }
              },
              "activo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  },
                  "example": {
                    "type": "boolean",
                    "example": false
                  }
                }
              }
            }
          },
          "anyOf": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "required": {
                  "type": "array",
                  "example": [
                    "id"
                  ],
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "UpsertManzana"
        }
      },
      "Tarifa": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "example": {
                    "type": "number",
                    "example": 5
                  }
                }
              },
              "concepto": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "ARRIENDO_7AÑOS"
                  }
                }
              },
              "alcance": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "GLOBAL",
                      "POR_TIPO",
                      "POR_ZONA"
                    ],
                    "items": {
                      "type": "string"
                    }
                  }
                }
              },
              "monto": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "number"
                  },
                  "example": {
                    "type": "number",
                    "example": 700
                  }
                }
              },
              "moneda": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "GTQ"
                  }
                }
              },
              "vigencia_desde": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "2025-01-01"
                  }
                }
              },
              "vigencia_hasta": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "tipo_nicho_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "manzana_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "sector_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "activo": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  },
                  "example": {
                    "type": "boolean",
                    "example": true
                  }
                }
              },
              "created_at": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "2025-01-01T12:00:00Z"
                  }
                }
              },
              "updated_at": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "2025-01-01T12:00:00Z"
                  }
                }
              }
            }
          }
        },
        "xml": {
          "name": "Tarifa"
        }
      },
      "CreateTarifa": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "concepto",
              "alcance",
              "monto",
              "vigencia_desde"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "concepto": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "ARRIENDO_7AÑOS"
                  }
                }
              },
              "alcance": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "GLOBAL",
                      "POR_TIPO",
                      "POR_ZONA"
                    ],
                    "items": {
                      "type": "string"
                    }
                  }
                }
              },
              "monto": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "number"
                  },
                  "example": {
                    "type": "number",
                    "example": 700
                  }
                }
              },
              "moneda": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "GTQ"
                  }
                }
              },
              "vigencia_desde": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "example": {
                    "type": "string",
                    "example": "2025-01-01"
                  }
                }
              },
              "vigencia_hasta": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "tipo_nicho_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "manzana_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              },
              "sector_id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "example": {}
                }
              }
            }
          }
        },
        "xml": {
          "name": "CreateTarifa"
        }
      }
    }
  }
}